import cv2
import numpy as np
from matplotlib import pyplot as plt
from string import Template
import time

def getVerticalPosition(resultPositions):
  maxX = 230
  minX = 220
  result = []
  bufferArray = []
  lastY = -20;
  for pt in resultPositions:
    X, Y = pt
    if (X > minX) and (X < maxX):
      if (Y - lastY >= 2):
        if len(bufferArray) > 0:
          middleIndex = int((len(bufferArray)-1)/2)
          result.append(bufferArray[middleIndex])
          bufferArray = []
      else:
        bufferArray.append(Y)
      lastY = Y
  if len(bufferArray) > 0:
    result.append(bufferArray[int((len(bufferArray)-1)/2)])
  return result

def getRoughInterval(totalResult, firstNotEmpty):
  result = {}
  for index in range(firstNotEmpty, firstNotEmpty + 20):
    for X in range(len(totalResult[index+1])):
      for Y in range(len(totalResult[index])):
        if totalResult[index+1][X] > totalResult[index][Y]:
          sub = totalResult[index+1][X] - totalResult[index][Y]
          if sub in result:
            result[sub] +=1
          else:
            result[sub] = 1
  return max(result, key=result.get)

def printNotes(notes):
  print("notes:")
  for noteIndex in range(0, len(notes)):
    print(str(noteIndex) + ": " + str(notes[noteIndex]))

start_time = time.time()

'''
# Get position from images
img_path_template = Template("frames_jpg/${index}.jpg")
output_path = "output/_result.txt"

total = 4004
step = 1

totalResult = []
firstNotEmpty = 0

with open(output_path, 'w') as result_file:
  for index in range(1,total):
    print("processing " + str(index) + "/" + str(total))

    img_path = img_path_template.substitute(index=index*step)
    img_rgb = cv2.imread(img_path)
    img_gray = cv2.cvtColor(img_rgb, cv2.COLOR_BGR2GRAY)
    template = cv2.imread('yellow_note.png',0)
    w, h = template.shape[::-1]

    templateMappingresult = cv2.matchTemplate(img_gray,template,cv2.TM_CCOEFF_NORMED)
    threshold = 0.8
    resultPositions = zip(*np.where(templateMappingresult >= threshold)[::-1])

    final = getVerticalPosition(resultPositions)
    print("final: " + str(final))
    result_file.write(" index: " + str(index * step) + " " + str(final) + "\n")
    totalResult.append(final)

    if (firstNotEmpty == 0) and final:
      firstNotEmpty = index

print(totalResult)
'''
# Convert position data to map data

totalResult = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [6], [21], [37], [14, 52], [29, 67], [6, 44, 82], [21, 59, 97], [37, 74, 112], [14, 52, 90, 128], [29, 67, 105, 143], [8, 44, 82, 120, 158], [23, 60, 97, 135, 173], [0, 38, 74, 113, 150, 188], [15, 53, 90, 128, 166, 204], [30, 68, 105, 143, 181, 219], [8, 46, 84, 120, 158, 196], [23, 61, 99, 135, 173, 211], [2, 38, 76, 114, 150], [17, 53, 91, 129], [32, 68, 107, 144], [9, 47, 84, 122], [25, 62, 99, 137], [2, 40, 78, 114, 152], [17, 55, 93, 129], [32, 70, 108, 145], [9, 47, 85, 123], [24, 62, 100, 138], [3, 40, 78, 116, 153], [18, 55, 93, 131], [33, 70, 108, 146], [11, 49, 85, 123], [26, 64, 100, 139], [3, 41, 79, 116, 154], [18, 56, 94, 131], [33, 71, 109, 146], [12, 49, 87, 125], [28, 64, 102, 140], [5, 43, 79, 117, 155], [20, 58, 94, 132], [35, 73, 109, 147], [12, 50, 88, 125], [27, 65, 103, 140], [5, 43, 81, 119, 155], [20, 58, 96, 134], [35, 73, 111, 149], [14, 50, 88, 126], [29, 65, 103, 142], [6, 44, 80, 118, 156], [22, 59, 96, 134], [36, 74, 111, 149], [14, 52, 90, 126], [29, 67, 105, 141], [6, 44, 82, 120, 156], [21, 59, 97, 135], [0, 37, 74, 112, 150], [15, 52, 90, 128], [31, 67, 105, 143], [46, 82, 120, 158], [61, 97, 135], [76, 112, 150], [91, 128], [107, 143], [122, 158], [137], [152], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [12], [28], [43], [58], [73], [88], [103], [119], [134], [149], [14, 164], [29, 179], [44, 194], [59, 210], [75], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64, 214], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [11], [26], [41], [56], [71, 220], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74, 224], [90], [105], [120], [135], [0, 150], [15], [31], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62, 213], [78], [93], [108], [123], [138], [3], [18], [33], [48], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [22], [36], [52], [67], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [139], [3, 154], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6, 156], [21], [37], [52], [67], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72, 222], [87], [102], [117], [132], [147], [14], [29], [44], [59], [74, 223], [90], [105], [120], [135], [0, 150], [15], [31], [46], [61], [76], [91], [107], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3, 153], [18], [33], [48], [64], [79], [94], [109], [125], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [36], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [2, 150], [17], [32], [47], [62], [78], [93], [108], [123], [138], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [9], [25], [40], [55], [70], [85], [100], [116], [131], [146], [11, 161], [26, 177], [41, 192], [56, 207], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [75], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [75], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2], [17], [32], [47], [62, 213], [78], [93], [108], [123], [138], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [36], [52], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [12], [28], [43], [58], [73, 223], [88], [104], [118], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [77], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [124], [140], [6], [21], [37], [52], [67, 216], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74, 224], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [1, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [87], [102], [117], [132], [147], [12], [27], [5, 43], [20, 58], [35, 73, 223], [50, 88], [65, 104], [80, 119], [96, 134], [111, 149], [126], [141], [], [], [], [], [], [], [], [0], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32, 182], [47, 198], [62, 213], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67, 217], [82], [97], [112], [128], [143], [9], [25], [40], [55], [70, 219], [85], [100], [115], [131], [146], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [104], [119], [134], [149], [14], [29], [44], [59], [75, 224], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [36], [52], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [69, 219], [83], [99], [114], [129], [145], [11], [26], [41], [56], [72, 220], [87], [102], [117], [132], [], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [34], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67, 217], [82], [97], [112], [127], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [101], [116], [131], [146], [12], [27], [43], [58], [73, 222], [88], [103], [119], [134], [149], [14], [29], [44], [59], [75], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [152], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [6], [21], [37], [14, 52], [29, 67], [6, 44, 82], [21, 59, 97], [37, 74, 113], [14, 52, 90, 128], [29, 67, 105, 143], [44, 82, 120, 158], [59, 97, 135, 173], [75, 112, 151, 188], [90, 128, 166, 204], [105, 143, 181, 219], [8, 120, 158, 196], [23, 135, 211], [38, 150], [53], [69], [84], [99, 211], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [14], [29], [44], [59], [74, 223], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [112], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [0, 149], [15], [30], [46], [61], [0, 76], [15, 91], [31, 107], [8, 46, 122], [23, 61, 137], [2, 38, 76, 152], [17, 53, 91], [32, 68, 106], [9, 47, 84, 122], [24, 62, 99, 137], [40, 78, 114], [55, 93, 129], [70, 108, 144], [85, 123], [100, 138], [115], [131], [146], [], [], [], [], [], [], [], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6, 156], [21, 172], [37, 187], [52, 202], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [86], [102], [117], [132], [147], [12], [28], [43], [58], [73], [88], [104], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [107], [122], [137], [3, 152], [18], [33], [49], [64], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65], [80], [96], [111], [126], [141], [6], [21], [36], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [68, 219], [8, 84], [23, 99], [38, 114], [53, 129], [68, 144], [84], [99], [114], [129], [144], [], [], [], [], [], [11], [26], [41], [56], [72], [87], [102], [117], [132], [147], [], [], [], [], [], [14], [29], [44], [59], [74], [90], [105], [120], [135], [], [], [], [], [], [0], [15], [30], [46], [61], [2, 76], [17, 91], [32, 106], [9, 47, 122], [24, 62, 137], [39, 78, 152], [54, 93], [70, 108], [85, 123], [100, 138], [3, 116, 154], [18, 131], [33, 146], [49], [64], [79], [94], [109], [12, 124], [27, 140], [42, 155], [57], [73], [88], [103], [6, 118], [21, 134], [37, 149], [52], [67], [82], [97], [112], [128], [143], [8, 158], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [101], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74, 224], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62, 213], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [6], [21], [37], [52], [67, 216], [82], [97], [113], [128], [143], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70, 221], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [2], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64, 214], [79], [94], [109], [124], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [8], [23], [38], [53], [69, 217], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [104], [119], [134], [149], [14], [29], [44], [60], [75], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [107], [122], [137], [2], [17], [32], [47], [62, 213], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [112], [128], [143], [9], [25], [40], [55], [70, 219], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [11, 87], [26, 102], [41, 117], [56, 132], [71, 147], [87], [102], [117], [132], [147, 223], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [2], [17], [32], [47], [62], [77], [93], [108], [123], [138], [154], [169], [], [], [214], [], [], [], [], [], [4], [20], [35], [50], [65], [80], [96], [111], [126], [141], [156], [], [], [], [217], [], [], [], [], [], [8], [23], [38], [53], [68], [83], [99], [114], [129], [144], [159], [], [], [], [220], [], [], [], [], [], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [162], [], [], [], [223], [], [], [], [], [], [14], [29], [44], [59], [74], [90], [105], [120], [135], [150], [165], [], [], [], [], [], [], [], [], [2], [17], [32], [47], [62], [77], [93], [108], [123], [138], [153], [], [], [], [214], [], [], [], [], [], [6], [21], [37], [52], [67], [82], [97], [112], [128], [143], [158], [], [], [], [], [], [], [], [], [], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [161], [], [], [], [222], [], [], [], [], [], [12], [27], [42], [57], [73], [88], [103], [118], [134], [149], [164], [], [], [], [], [], [], [], [], [0], [15], [30], [46], [61], [76], [91], [106], [121], [137], [152], [167], [], [], [213], [], [], [], [], [], [3], [18], [33], [48], [64], [79], [94], [109], [125], [140], [155], [], [], [], [], [], [], [], [], [], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [159], [], [], [], [220], [], [], [], [], [], [10], [26], [41], [56], [71], [87], [102], [117], [132], [147], [163], [], [], [], [223], [], [], [], [], [], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15, 166], [31], [46], [61], [76], [91], [106], [122], [137], [152], [], [], [], [], [3], [18], [34], [49], [64], [79], [94], [110], [125], [140], [], [], [], [], [], [5], [20], [35], [50], [66], [81], [96], [111], [126], [141], [], [], [], [], [], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [25, 175], [40, 190], [55, 205], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [0, 149], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64, 214], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70, 221], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71], [12, 87], [27, 102], [4, 43, 117], [20, 58, 132], [35, 73, 147], [50, 88], [65, 103], [80, 119], [96, 134], [111, 223], [126], [141], [], [], [], [14], [29], [8, 44], [23, 59], [38, 75], [53, 90], [68, 105], [84, 120], [99, 135], [114, 150], [129], [144], [159], [], [2], [17], [32, 220], [9, 47], [24, 62], [3, 39, 78], [18, 55, 93], [33, 70, 108], [11, 49, 85, 123], [26, 64, 100, 139], [41, 79, 115, 154], [56, 94, 130], [71, 109, 146], [87, 125, 161], [102, 140], [5, 117, 155], [20, 132, 170], [35, 147], [50], [65], [81], [96], [111], [126], [142], [6, 156], [21], [37], [52], [67, 217], [82], [97], [113], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 220], [85], [100], [116], [131], [146], [11], [26], [41], [56], [72], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [104], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [107], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [139], [5, 153], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6, 156], [21], [37], [52], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [145], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [0, 75], [15, 90], [30, 105], [46, 120], [61, 135], [76, 150], [91], [106], [122], [137, 211], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3, 153], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [68], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70], [85], [101], [115], [131], [146], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [], [], [], [], [223], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14, 164], [29, 179], [44, 194], [59, 210], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64, 214], [79], [94], [110], [125], [140], [5], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [37], [52], [67, 217], [82], [97], [113], [128], [143], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73], [88], [103], [119], [134], [149], [14], [29], [44], [59], [75, 224], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62, 213], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [110], [124], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [142], [6], [21], [37], [52], [67, 217], [82], [97], [113], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [12], [27], [42], [58], [73, 223], [88], [103], [119], [134], [149], [14], [29], [44], [59], [74], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3, 153], [18], [33], [49], [64, 214], [79], [94], [109], [124], [140], [5], [20], [35], [50], [65], [80], [96], [111], [126], [141], [6], [21], [37], [52], [67], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70, 221], [85], [100], [116], [131], [146], [12], [27], [43], [58], [73], [88], [103], [118], [134], [149], [14], [29], [44], [59], [74, 224], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [0, 76], [15, 91], [30, 106], [46, 122], [61, 137], [2, 76, 152], [17, 91], [32, 106], [47, 122], [62, 137, 213], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64, 214], [79], [94], [109], [124], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6, 156], [21], [36], [52, 202], [67, 217], [82], [97], [113], [128], [143], [8], [23], [38], [53], [69, 219], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70], [85], [100], [115], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [14], [29], [44], [59], [74, 223], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61, 211], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3], [18], [33], [49], [64], [79], [94], [109], [125], [140], [5], [20], [35], [50], [65, 216], [81], [96], [111], [126], [141], [6], [21], [36], [52], [67, 217], [82], [97], [112], [128], [143], [8], [23], [38], [53], [69], [84], [99], [114], [129], [144], [9], [25], [40], [55], [70, 221], [85], [101], [116], [131], [146], [11], [26], [41], [56], [71, 222], [87], [102], [117], [132], [147], [12], [27], [43], [58], [73, 223], [88], [104], [119], [134], [0, 149], [15], [30], [46], [61], [76], [91], [107], [122], [137], [2], [17], [32], [47], [62], [78], [93], [108], [123], [138], [3, 153], [18], [33], [49], [64], [79], [94], [109, 260], [125], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111, 261], [126], [142], [6, 156], [21], [37], [52], [67], [82], [97], [113], [128], [143], [8], [23], [38], [53], [68, 219], [84], [99], [114], [129], [144], [9], [24], [40], [55], [70], [85], [100], [116], [131], [146], [11], [26], [41], [56], [71], [87], [102], [117], [132], [147], [12], [28], [43], [58], [73], [14, 88], [29, 103], [44, 119], [59, 134], [75, 149], [90], [105], [120], [135], [0, 150], [15], [30], [46], [61], [76], [91], [106], [122], [137], [2, 152], [17], [32], [47], [63], [78], [93], [108], [123], [138], [3, 153], [18], [34], [49], [64], [79], [94], [110], [125], [140], [5, 155], [20], [35], [50], [65], [81], [96], [111], [126], [141], [6], [21], [36], [51], [67], [82], [97], [112], [128], [143], [8], [23], [38], [53], [68, 219], [9, 84], [24, 99], [40, 114], [55, 129], [70, 144], [11, 85], [26, 101], [41, 116], [56, 131], [72, 146], [11, 87], [26, 102], [41, 117], [56, 132], [72, 148], [87], [102], [117], [132], [147], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [9], [24], [2, 40], [17, 55], [32, 70], [11, 47, 85], [26, 62, 100], [3, 41, 78, 116], [18, 56, 93, 131], [34, 72, 108, 146], [11, 49, 87, 123, 161], [26, 64, 102, 138, 176], [3, 41, 79, 117, 154, 192], [18, 56, 94, 132, 169, 207], [33, 71, 110, 147, 184, 222], [12, 49, 87, 124, 163, 199], [28, 64, 102, 140, 214], [5, 43, 79, 117, 155], [20, 58, 94, 132], [35, 73, 110, 147], [12, 50, 88, 124], [27, 65, 103, 140], [6, 43, 81, 119, 155], [21, 58, 96, 134], [37, 73, 111, 149], [14, 52, 88, 126], [29, 67, 103, 142], [6, 44, 82, 119, 156], [21, 59, 97, 134], [36, 74, 112, 149], [14, 52, 90, 128], [29, 67, 105, 143], [8, 44, 82, 120, 158], [23, 59, 97, 135, 210], [0, 38, 74, 113, 151], [15, 53, 90, 128], [30, 68, 105, 143], [46, 84, 120, 158], [61, 99, 135], [76, 114, 151], [91, 129], [106, 144], [122], [137], [152], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []]

firstNotEmpty=115

# merge position of same note into one list

roughInterval = getRoughInterval(totalResult, firstNotEmpty)
print("roughInterval " + str(roughInterval))

notes = []
current = 0
tolerance = 2
firstPositionLimitation = 50

for index in range(0, len(totalResult)):
  for notePosition in totalResult[index]:
    currentNote = (index, notePosition)
    if len(notes) == 0: # To distinguish the first time
      notes.append([currentNote])
    else:
      isOldNote = False
      for noteIndex in range(0, len(notes)):
        if abs(notePosition - notes[noteIndex][-1][1] - roughInterval) < tolerance and index == notes[noteIndex][-1][0] + 1:
          print("old note!")
          notes[noteIndex].append(currentNote)
          isOldNote = True
          break;
      if not isOldNote:
        # Too large notePosition means this note has already been recognized before
        if notePosition < firstPositionLimitation:
          print("new note!")
          notes.append([currentNote])
    print("index " + str(index) + " notePosition " + str(notePosition))
    print("------------------------------------------")

printNotes(notes)

# calculate the average interval

averageInterval = 0

for note in notes:
  interval = (note[-1][1] - note[0][1]) / (note[-1][0] - note[0][0])
  print("interval: " + str(interval))
  averageInterval += interval

averageInterval = averageInterval / len(notes)

print("averageInterval: " + str(averageInterval))


print("--- %s seconds ---" % (time.time() - start_time))

